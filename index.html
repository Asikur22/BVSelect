<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="BVSelect Jquery">
  <meta name="author" content="Bruno Vieira">

  <title>BVSelect Jquery Plugin</title>

  <!-- BVSelect Plugin Style -->
    <link rel="stylesheet" type="text/css" href="css/bvselect.css">

  <!-- *** OPTIONAL *** -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <!-- DEMO ONLY -->
    <link href="demo-template/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
      html,body {  font-family:Arial;  }
    </style>

</head>
<body style="min-height:1000px;">
  <div class="container">

    <div class="card  my-5 py-4 text-center" style=" border:0px; margin-top:150px!important; position: relative;">
      <div class="card-body">
        <p class="text-white m-0"><img style="max-width:500px; width:100%;" src="demo-template/images/BV.png"></p>
      </div>
    </div>

    <div class="row">
      <div class="col-md-4 mb-5" style="border:0px;">
        <div class="card h-100" style="border:0px;">
          <div >
          <h3>Basic:</h3>
              <select id="selectbox" onchange="alert('olaa');">
                  <option data-separator="true" value="##">Select Option</option>
                  <option data-img="https://img.icons8.com/color/2x/portugal.png" value="pt_1">Option 1</option>
                  <option data-img="https://img.icons8.com/color/2x/portugal.png" value="en_2">Option 2 </option>
                  <option data-img="https://img.icons8.com/color/2x/portugal.png" value="es_3" disabled>Option 3 (Disabled)</option>
                  <option data-img="https://img.icons8.com/color/2x/portugal.png" value="ch_4">Option 4</option>
                  <option data-img="https://img.icons8.com/color/2x/portugal.png" value="5">Option 5</option>
              </select>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-5" style="border:0px;">
        <div class="card h-100" style="border:0px;">
          <div >
          <h3>Basic:</h3>
              <select id="selectbox2">
                  <option data-separator="true" value="##">Select Option</option>
                  <option value="pt_1">Option 1</option>
                  <option value="en_2" selected>Option 2 </option>
                  <option value="es_3" disabled>Option 3 (Disabled)</option>
                  <option value="ch_4">Option 4</option>
                  <option value="5">Option 5</option>
              </select>
          </div>
        </div>
      </div>
      <div class="col-md-4 mb-5" style="border:0px;">
        <div class="card h-100" style="border:0px;">
          <div >
          <h3>Basic:</h3>
              <select id="selectbox3">
                  <option data-separator="true" value="##">Select Option</option>
                  <option value="pt_1">Option 1</option>
                  <option value="en_2">Option 2 </option>
                  <option value="es_3" disabled>Option 3 (Disabled)</option>
                  <option value="ch_4">Option 4</option>
                  <option value="5">Option 5</option>
              </select>
          </div>
        </div>
      </div>


    </div>
  </div>

  <script >

      // BEGIN BVSELECT CLASS
      class BVSelect{

          constructor({selector = 'defaultId', width = "100%", searchbox = false}){

            // Define Variables
            this.selector = selector.substring(1);
            this.searchbox = searchbox;
            this.width = width;

            // Random Number generated
            var randomID =  Math.floor(Math.random() * (9999 - 0 + 1)) + 0;

            // Hides native selector
            document.getElementById(this.selector).style.display = "none";

            // ** ADD OPTIONS TO LIST **
            this.SetupListOptions = function ()
            {
                // Get All options inside Selectbox
                var x = document.getElementById(this.selector);
                for (var i = 0; i < x.length; i++) {

                     var optionText = x[i].text;
                     var optionValue = x[i].value;
                     var optionDisabled = x[i].disabled;
                     var optionSeparator = x[i].getAttribute("data-separator");
                     var optionImg = x[i].getAttribute("data-img");
                     var optionIcon = x[i].getAttribute("data-icon");

                    // Option Disabled
                    if(optionDisabled == true) { var is_disabled = "bv_disabled"; } else { var is_disabled = ""; }
                    // Separator
                    if(optionSeparator) { var is_separator = "bv_separator"; } else { var is_separator = ""; }
                    // Check for Attachment  
                    if (optionImg) { var has_attachment = "<img src=" + optionImg + ">"; } else { if (optionIcon) { var has_attachment = "<i class='" + optionIcon + "' aria-hidden='true'></i>"; } else { var has_attachment = ""; }}

                    // Append
                    document.getElementById("ul_"+randomID).insertAdjacentHTML('beforeend', "<li class='" + is_disabled + " " + is_separator + "'  > " + has_attachment + " " + optionText + "</li>");
                  }



                  document.querySelectorAll('#ul_'+randomID+' li').forEach((item) => {
                      item.addEventListener('click', (e) => {
                          const index = Array.from(item.parentNode.children).indexOf((item))

        
                          document.getElementById(this.selector).getElementsByTagName('option')[index-1].selected = 'selected';
                                 document.getElementById(this.selector).onchange();
                           
                      })
                  })


            }

            // ** CREATE MAIN **
            this.CriarDivBase = function () {

                document.getElementById(this.selector).insertAdjacentHTML('afterend', '<div id="bv_' + randomID + '" data-search="' + this.searchbox + '" class="bv_mainselect"></div>');
                document.getElementById("bv_"+randomID).insertAdjacentHTML('afterbegin', '<div id="main_' + randomID + '" style="width:' + this.width + ';" class="bv_atual bv_background"></div><ul id="ul_' + randomID + '" class="bv_ul_inner bv_background"></ul>');
                  
                var element_ul = document.getElementById('ul_'+randomID);
                var element_bv = document.getElementById('bv_'+randomID);

                // Set Width of UL
                var select_width = document.getElementById("main_"+randomID).offsetWidth;
                console.log(select_width);
                element_ul.style.width = select_width+ "px";

                if (this.searchbox == true) 
                {
                    document.querySelector("#ul_" + randomID).insertAdjacentHTML('afterbegin', '<li class="nofocus"><div class="innerinput"><input placeholder="Search..." class="bv_input" id="input_' + randomID + '" type="text"></div</li>');
                }

                // Get Selected Option
                var selected_option = document.getElementById(this.selector);
                var selected_option_text = selected_option.options[selected_option.selectedIndex].text;

                // Check if there is a selected option, if not, gets the first
                if(selected_option_text == "")
                {
                  first_option = document.getElementById(this.selector).selected_option = "0";
                  first_option_text = selected_option.options[selected_option.selectedIndex].text;
                  document.getElementById("main_"+randomID).innerHTML = first_option_text + "<i id='arrow_" + randomID + "' class='arrows_bv arrow down'></i>"; 
                } else {
                  document.getElementById("main_"+randomID).innerHTML = selected_option_text + "<i id='arrow_" + randomID + "' class='arrows_bv arrow down'></i>"; 
                }

                // Add event Listener on click main div
                document.getElementById("main_"+randomID).addEventListener("click", function(){

                   if(document.getElementById('ul_'+randomID).style.display == 'block') {

                        document.getElementById('ul_'+randomID).style.display = 'none';
                        Array.from(document.querySelectorAll(".arrows_bv"))
                            .forEach(function(val) {
                                val.classList.remove("up");
                                val.classList.add("down");
                        });

                    } else {

                        Array.from(document.querySelectorAll(".bv_ul_inner"))
                            .forEach(function(val) {
                                val.style.display = 'none';
                        });
                        document.getElementById('ul_'+randomID).style.display = 'block';
                        Array.from(document.querySelectorAll(".arrows_bv"))
                            .forEach(function(val) {
                                val.classList.remove("up");
                                val.classList.add("down");
                        });
                        document.querySelector("#arrow_" + randomID).classList.remove("down");
                        document.querySelector("#arrow_" + randomID).classList.add("up");            
                    }

                }, false); 

                // Criar Lista
                this.SetupListOptions();

            }

            // Crates the Main Div
            this.CriarDivBase();


            // ** SEARCH BAR **
            document.getElementById("input_"+randomID).addEventListener("keyup", function(){
                  var input, filter, ul, li, i, txtValue;
                  input = document.getElementById("input_"+randomID);
                  filter = input.value.toUpperCase();
                  ul = document.getElementById("ul_"+randomID);
                  li = ul.getElementsByTagName("li");
            
                  for (i = 0; i < li.length; i++) {
                      
                      txtValue = li[i].innerText || li[i].textContent;
                      if (txtValue.toUpperCase().indexOf(filter) > -1) {
                          li[i].style.display = "";
                      } else {
                        if(!li[i].classList.contains("nofocus")) { li[i].style.display = "none"; } 
                      }
                  }
              }, false); 

              // ** CLICK OUTSIDE **
              document.addEventListener("click", function(e){
                if(!e.target.closest(".bv_mainselect") || !e.target.closest(".bv_atual") || !e.target.closest(".bv_ul_inner"))
                {
                  if(!event.target.classList.contains('bv_input'))
                  {
                      Array.from(document.querySelectorAll(".bv_ul_inner"))
                          .forEach(function(val) {
                              val.style.display = 'none';
                      });
                      Array.from(document.querySelectorAll(".arrows_bv"))
                          .forEach(function(val) {
                              val.classList.remove("up");
                              val.classList.add("down");
                      });
                  }
                }
              }, true);
          }

        // ** METHODS ** 

         Update(){

            
         }

      }

      document.addEventListener("DOMContentLoaded", function() {

            var test = new BVSelect({
              selector: "#selectbox",
              searchbox: true
            });

            var test2 = new BVSelect({
              selector: "#selectbox2",
              searchbox: true
            });

            var test3 = new BVSelect({
              selector: "#selectbox3",
              searchbox: true
            });

       //   test.Update();
      });


  </script>
</body>

</html>
